<div class="flex flex-col gap-5 w-full h-full items-center pt-28 px-52 max-md:px-8 max-lg:px-20">
  <div class="flex flex-col gap-5 w-full border border-secondary-200 bg-secondary-100 bg-opacity-50 rounded-md p-4">
    <div class="flex gap-5 items-center">
      <h2 class="text-secondary-900 text-xl font-semibold">Your information</h2>
      <div class="flex gap-2 items-center">
        @if(updateStatus === "OK") {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 fill-secondary-900"
        >
          <path
            fill-rule="evenodd"
            d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"
            clip-rule="evenodd"
          />
        </svg>

        <label
          for="updateError"
          class="text-sm font-medium text-secondary-900"
        >
          Up to date
        </label>
        } @else if(updateStatus === "Loading") {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 stroke-secondary-900 animate-spin"
        >
          <path
            fill-rule="evenodd"
            d="M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z"
            clip-rule="evenodd"
          />
        </svg>
        } @else {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 fill-red-600"
        >
          <path
            fill-rule="evenodd"
            d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"
            clip-rule="evenodd"
          />
        </svg>

        <label
          for="updateError"
          class="text-sm text-red-600"
          >{{ updateStatus }}</label
        >
        }
      </div>
    </div>

    @defer(when user) {
    <div class="grid grid-cols-2 gap-5 max-md:flex max-md:flex-col">
      <div>
        <label
          for="name"
          class="block font-medium leading-6 text-secondary-900"
          >Name</label
        >
        <div class="mt-1">
          <input
            type="text"
            name="name"
            id="name"
            (blur)="saveUserProfile()"
            [(ngModel)]="user.name"
            class="block w-full bg-transparent rounded-md border-0 py-1.5 text-secondary-900 shadow-sm ring-1 ring-inset ring-secondary-300 placeholder:text-secondary-900 placeholder:text-opacity-50 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
            placeholder="Aline"
          />
        </div>
      </div>

      <div>
        <label
          for="last_name"
          class="block font-medium leading-6 text-secondary-900"
          >Family Name</label
        >
        <div class="mt-1">
          <input
            type="text"
            name="last_name"
            id="last_name"
            (blur)="saveUserProfile()"
            [(ngModel)]="user.last_name"
            class="block w-full bg-transparent rounded-md border-0 py-1.5 text-secondary-900 shadow-sm ring-1 ring-inset ring-secondary-300 placeholder:text-secondary-900 placeholder:text-opacity-50 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
            placeholder="AUBERTIN"
          />
        </div>
      </div>
    </div>

    <div class="w-full">
      <div class="">
      <label
        for="pp"
        class="block font-medium leading-6 text-secondary-900"
        >Profile picture URL</label
      >
      <div class="mt-1 flex flex-row gap-2" >
        <input
          type="text"
          name="pp"
          id="pp"
          (blur)="saveUserProfile()"
          [(ngModel)]="user.avatar_url"
          class="w-full bg-transparent rounded-md border-0 py-1.5 text-secondary-900 shadow-sm ring-1 ring-inset ring-secondary-300 placeholder:text-secondary-900 placeholder:text-opacity-50 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
          placeholder="https://storage.iseplife.fr/img/usr/..."
        />
        <div class="w-[15%] text-center">
          <label for="upload-photo" class="cursor-pointer block bg-transparent rounded-md border-0 p-1.5 text-secondary-900 ring-1 ring-inset ring-secondary-300">Upload picture</label>
          <input type="file" name="photo" id="upload-photo" class="opacity-0 z-[-1] absolute" (change)="selectFile($event)"/>
        </div>
        <div class="w-[14%] text-center">
          <label (click)="setAvatarToLatestUploadedImage()" class="cursor-pointer block bg-transparent rounded-md border-0 p-1.5 text-secondary-900 ring-1 ring-inset ring-secondary-300">Check URL</label>
        </div>
      </div>
      </div>
    </div>

    <div class="flex flex-col gap-1">
      <h3 class="text-secondary-900 font-semibold">Interests</h3>
      <div class="flex gap-2 w-full flex-wrap">
        @for (interest of interests.values(); track $index) {
        <button
          (click)="toggleInterest(interest)"
          class="px-2 py-1 rounded-full border-secondary-900 border text-sm whitespace-nowrap transition-all"
          [ngClass]="
            interest.followed ? 'bg-secondary-900 text-white hover:bg-opacity-80' : 'text-secondary-900 hover:bg-secondary-200'
          "
        >
          {{ interest.name }}
        </button>
        }
      </div>
    </div>
    }
  </div>

  <div class="flex w-full min-w-1 items-center gap-5 border-secondary-200 border bg-secondary-100 bg-opacity-50 rounded-md p-4 place-content-between">

    <div class="flex flex-row w-fit whitespace-nowrap items-center gap-10">
    <div class="flex flex-col w-full items-start text-secondary-900">
      <h3 class="font-medium text-base w-fit">Your posts</h3>
      <p class="text-sm font-light w-fit text-pretty">Manage your posts</p>
    </div>
    <div class="w-full flex items-center gap-2 text-secondary-900">
      <button
        (click)="toggleSeePosts()"
        class="px-2 py-0.5 rounded-full border-secondary-900 border text-sm whitespace-nowrap transition-all"
        [ngClass]="
            showMyPostsInFeed ? 'bg-secondary-900 text-white hover:bg-opacity-80' : 'text-secondary-900 hover:bg-secondary-200'
          ">
        <ng-container *ngIf="showMyPostsInFeed">
          <span class="text-white">✓</span>
        </ng-container>
        <ng-container *ngIf="!showMyPostsInFeed">
          <span class="text-secondary-900">X</span>
        </ng-container>
      </button>
      Show my posts in feed
    </div>
      </div>


    <div class="flex w-fit items-center">
      <button
        type="button"
        (click)="navigateToMyPostsPage()"
        class="inline-flex items-center gap-x-1.5 rounded-md bg-red-900 px-3 py-2.5 font-semibold text-white shadow-sm hover:bg-secondary-950 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary-900 whitespace-nowrap transition-all active:scale-95"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="white"
          viewBox="0 0 24 24"
          stroke-width="0"
          stroke="currentColor"
          class="w-6 h-6 mr-1"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"/>
        </svg>

        View
      </button>
    </div>
  </div>

  <!-- Logout -->
  <app-logout-form class="w-full"></app-logout-form>

  <div class="flex flex-col w-full h-fit gap-2">
    <h1 class="text-red-900 text-2xl font-bold">Danger Zone</h1>

    <!-- Delete Account -->
    <div class="flex w-full min-w-1 items-center gap-3 border-red-200 border bg-red-100 bg-opacity-50 rounded-md p-4">
      <div class="flex flex-col w-full items-start text-red-900">
        <h3 class="font-medium text-base w-fit">Delete your account</h3>
        <p class="text-sm font-light w-fit text-pretty">
          This action will permanently delete all your data and kinship with other users; it’s not reversible.
        </p>
      </div>
      <div class="flex w-fit items-center">
        <button
          type="button"
          (click)="deleteAccount()"
          class="inline-flex items-center gap-x-1.5 rounded-md bg-red-900 px-3 py-2.5 font-semibold text-white shadow-sm hover:bg-secondary-950 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-secondary-900 whitespace-nowrap transition-all active:scale-95"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-6 h-6 mr-1"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"
            />
          </svg>

          Delete
        </button>
      </div>
    </div>
  </div>
</div>
